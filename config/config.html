<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ConfiguraÃ§Ãµes â€“ Sistema</title>

<!-- MANIFEST -->
<link rel="manifest" href="../manifest.json">
<meta name="theme-color" content="#7b3f2a">

<!-- MENU GLOBAL -->
<link rel="stylesheet" href="../menu/menu.css">

<!-- CONFIG CSS -->
<link rel="stylesheet" href="./config.css">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
if (!firebase.apps.length) {
  firebase.initializeApp({
    apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
    authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
    projectId: "sitio-corrego-do-pinhal"
  });
}
</script>

<!-- IDENTIFICAÃ‡ÃƒO DA PÃGINA -->
<script>
window.PERMISSAO_PAGINA = {
  area: "config",
  chave: "config"
};
</script>

<!-- AUTH GUARD -->
<script src="../login/auth-guard.js"></script>
</head>

<body style="display:none">

<header>âš™ï¸ ConfiguraÃ§Ãµes</header>

<div id="menu-adm"></div>

<div class="container">

  <h2>ConfiguraÃ§Ã£o do Sistema</h2>

  <div class="cards-grid">

    <button class="config-card" data-permissao="config-geral" onclick="location.href='config-geral.html'">
      ğŸ§­ <span>Geral</span>
    </button>

    <button class="config-card" data-permissao="config-bezerros" onclick="location.href='config-bezerros.html'">
      ğŸ® <span>Bezerros</span>
    </button>

    <button class="config-card" data-permissao="config-vacinas" onclick="location.href='config-vacinas.html'">
      ğŸ’‰ <span>Vacinas</span>
    </button>

    <button class="config-card" data-permissao="config-vacas" onclick="location.href='config-vacas.html'">
      ğŸ„ <span>Vacas</span>
    </button>

    <button class="config-card" data-permissao="config-leite" onclick="location.href='config-leite.html'">
      ğŸ¥› <span>Leite</span>
    </button>

    <button class="config-card" data-permissao="config-despesas" onclick="location.href='config-despesas.html'">
      ğŸ’° <span>Despesas</span>
    </button>

    <button class="config-card" data-permissao="config-especies" onclick="location.href='config-especies.html'">
      ğŸ§¬ <span>EspÃ©cies</span>
    </button>

    <button class="config-card" data-permissao="config-farmacia" onclick="location.href='config-farmacia.html'">
      ğŸ’Š <span>FarmÃ¡cia</span>
    </button>

    <button class="config-card" data-permissao="config-clima" onclick="location.href='config-clima.html'">
      ğŸŒ¦ï¸ <span>Clima</span>
    </button>

    <button class="config-card" data-permissao="config-usuarios" onclick="location.href='config-usuarios.html'">
      ğŸ‘¤ <span>UsuÃ¡rios</span>
    </button>

    <button class="config-card" data-permissao="config-grupos" onclick="location.href='config-grupos.html'">
      ğŸ‘¥ <span>Grupos de UsuÃ¡rios</span>
    </button>

  </div>
</div>

<!-- MENU ADM â€“ PADRÃƒO GLOBAL DEFINITIVO -->
<script>
fetch("../menu/menu-adm.html")
  .then(r => r.text())
  .then(html => {
    document.getElementById("menu-adm").innerHTML = html;

    document.querySelectorAll(".menu-link").forEach(a=>{
      if(a.getAttribute("href")?.includes("config.html")){
        a.classList.add("ativo");
      }
    });

    const s = document.createElement("script");
    s.src = "../menu/menu-permissoes.js";
    s.onload = () => {

      /* ğŸ”’ FILTRO DE PERMISSÃƒO DOS CARDS */
async function filtrarCardsConfig(){
  const user = firebase.auth().currentUser;
  if(!user) return;

  const snap = await firebase.firestore()
    .collection("usuarios")
    .doc(user.uid)
    .get();

  if(!snap.exists) return;

  const papel = snap.data().papel;
  if(!papel) return;

  const grupoSnap = await firebase.firestore()
    .collection("config")
    .doc("grupos")
    .get();

  if(!grupoSnap.exists) return;

  const grupo = grupoSnap.data().lista
    .find(g => g.id === papel);

  if(!grupo) return;

  const permissoesConfig = grupo.permissoes?.config || {};

  document.querySelectorAll(".config-card").forEach(card=>{
    const chave = card.dataset.permissao;

    if(
      !permissoesConfig.tudo &&
      !permissoesConfig[chave]
    ){
      card.remove();
    }
  });
}

      document.body.style.display = "block";
    };
    document.body.appendChild(s);
  });
</script>

<!-- LOGOUT GLOBAL -->
<script src="../login/logout.js"></script>

</body>
</html>
