<!-- ../menu/menu.html -->
<div class="menu-wrapper">
  <nav class="menu-adm" id="menu-links">

    <a href="../app/index.html" class="menu-link" data-area="app" data-chave="inicio">
      游 <span>In칤cio</span>
    </a>

    <a href="../app/lembretes.html" class="menu-link" data-area="app" data-chave="lembretes">
      游닇 <span>Lembretes</span>
    </a>

    <a href="../app/animais.html" class="menu-link" data-area="app" data-chave="animais">
      游 <span>Animais</span>
    </a>

    <a href="../app/vacas.html" class="menu-link" data-area="app" data-chave="vacas">
      游낷 <span>Vacas</span>
    </a>

    <a href="../app/bezerros.html" class="menu-link" data-area="app" data-chave="bezerros">
      游냝 <span>Bezerros</span>
    </a>

    <a href="../app/historico.html" class="menu-link" data-area="app" data-chave="historico">
      游닆 <span>Hist칩rico</span>
    </a>

    <a href="../app/farmacia.html" class="menu-link" data-area="app" data-chave="farmacia">
      游눍 <span>Farm치cia</span>
    </a>

    <a href="../app/vacinas.html" class="menu-link" data-area="app" data-chave="vacinas">
      游눌 <span>Vacinas</span>
    </a>

    <a href="../app/leite.html" class="menu-link" data-area="app" data-chave="leite">
      游볱 <span>Leite</span>
    </a>

    <a href="../app/despesas.html" class="menu-link" data-area="app" data-chave="despesas">
      游눯 <span>Despesas</span>
    </a>

    <a href="../app/relatorios.html" class="menu-link" data-area="app" data-chave="relatorios">
      游늵 <span>Relat칩rios</span>
    </a>

    <a href="#" class="menu-link sair" id="btnLogout">
      游뛁 <span>Sair</span>
    </a>

  </nav>
</div>

<script>
/* ======================================================
   CONTROLE DE PERMISS칏ES DO MENU (APP)
   ====================================================== */

(async function(){

  const auth = firebase.auth();
  const db   = firebase.firestore();

  auth.onAuthStateChanged(async user=>{
    if(!user){
      ocultarTudo();
      return;
    }

    try{
      const snapUser = await db.collection("usuarios").doc(user.uid).get();
      if(!snapUser.exists){
        ocultarTudo();
        return;
      }

      const grupoId = snapUser.data().papel;

      const snapCfg = await db.collection("config").doc("grupos").get();
      if(!snapCfg.exists){
        ocultarTudo();
        return;
      }

      const grupo = snapCfg.data().lista.find(g => g.id === grupoId);
      if(!grupo){
        ocultarTudo();
        return;
      }

      document.querySelectorAll(".menu-link[data-area]").forEach(link=>{
        const area  = link.dataset.area;
        const chave = link.dataset.chave;

        const permitido =
          grupo.permissoes?.[area]?.[chave] === true ||
          grupo.permissoes?.config?.tudo === true;

        if(!permitido){
          link.style.display = "none";
        }
      });

    }catch(err){
      console.error("Erro ao aplicar permiss칫es do menu:", err);
      ocultarTudo();
    }
  });

  function ocultarTudo(){
    document.querySelectorAll(".menu-link").forEach(l=>{
      if(!l.classList.contains("sair")){
        l.style.display = "none";
      }
    });
  }

})();
</script>

<script>
/* ======================================================
   LOGOUT
   ====================================================== */
document.getElementById("btnLogout")?.addEventListener("click", async e=>{
  e.preventDefault();
  await firebase.auth().signOut();
  location.href = "../login/login.html";
});
</script>