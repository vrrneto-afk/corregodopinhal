(async ()=>{
  const db = firebase.firestore();

  const snapEventos = await db.collection("eventos").get();
  const snapAnimais = await db.collection("animais").get();

  const animais = {};
  snapAnimais.docs.forEach(d=>{
    animais[d.id] = d.data();
  });

  let corrigidos = 0;

  for(const doc of snapEventos.docs){
    const e = doc.data();

    // Só corrige se não tiver nome_animal
    if(e.id_animal && !e.nome_animal){
      const a = animais[e.id_animal];
      if(a){
        await db.collection("eventos").doc(doc.id).update({
          nome_animal: a.nome || "",
          especie: a.especie || ""
        });
        corrigidos++;
      }
    }
  }

  alert(`Correção concluída. Eventos corrigidos: ${corrigidos}`);
})();