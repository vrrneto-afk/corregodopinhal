<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat칩rios</title>

<meta name="theme-color" content="#7b3f2a">
<link rel="manifest" href="../manifest.json">
<link rel="stylesheet" href="../menu/menu.css">

<!-- FIREBASE (CDN OFICIAL) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
});
</script>

<style>
body{
  margin:0;
  background:#f6efe7;
  font-family:system-ui,Arial;
  color:#333;
}

header{
  background:#D0B485;
  padding:15px;
  text-align:center;
}

header img{
  max-width:240px;
}

.container{
  max-width:900px;
  margin:20px auto;
  padding:0 15px;
}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}

.card{
  background:#fff;
  border-left:6px solid #7b3f2a;
  padding:16px;
  border-radius:14px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.2s;
}

.card:hover{
  transform:translateY(-2px);
}
</style>
</head>

<body>

<header>
  <img src="../logo.png" alt="S칤tio C칩rrego do Pinhal">
</header>

<div id="menu"></div>

<div class="container">
  <h2>游늵 Relat칩rios</h2>
  <p>Selecione o relat칩rio que deseja acessar.</p>

  <div class="cards" id="cards"></div>
</div>

<script>
const RELATORIOS = [
  {
    id: "relatorio_financeiro",
    titulo: "游눯 Financeiro",
    url: "../relatorios/relatorio-financeiro.html"
  },
  {
    id: "relatorio_leite",
    titulo: "游볱 Produ칞칚o de Leite",
    url: "../relatorios/relatorio-leite.html"
  },
  {
    id: "relatorio_rebanho",
    titulo: "游낷 Rebanho",
    url: "../relatorios/relatorio-rebanho.html"
  },
  {
    id: "relatorio_sanitario",
    titulo: "游눌 Sanit치rio",
    url: "../relatorios/relatorio-sanitario.html"
  }
];

firebase.auth().onAuthStateChanged(async user=>{
  if(!user){
    location.href="../login/login.html";
    return;
  }

  const db = firebase.firestore();

  const snapUser = await db.collection("usuarios").doc(user.uid).get();
  if(!snapUser.exists){
    alert("Usu치rio n칚o autorizado.");
    return;
  }

  const papel = snapUser.data().papel;

  const snapGrupo = await db.collection("config").doc("grupos").get();
  const grupo = snapGrupo.data().lista.find(g=>g.id===papel);
  const perms = grupo.permissoes?.app || {};

  const container = document.getElementById("cards");

  let algum = false;

  RELATORIOS.forEach(r=>{
    if(perms[r.id] === true){
      algum = true;
      const div = document.createElement("div");
      div.className="card";
      div.textContent = r.titulo;
      div.onclick = ()=>location.href=r.url;
      container.appendChild(div);
    }
  });

  if(!algum){
    container.innerHTML = "<p>Nenhum relat칩rio dispon칤vel para seu perfil.</p>";
  }
});
</script>

<script>
fetch("../menu/menu.html")
  .then(r=>r.text())
  .then(h=>document.getElementById("menu").innerHTML=h);
</script>

<script src="../login/logout.js"></script>

</body>
</html>