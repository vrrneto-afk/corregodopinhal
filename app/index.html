<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>S√≠tio C√≥rrego do Pinhal</title>

<link rel="manifest" href="../manifest.json">
<meta name="theme-color" content="#7b3f2a">

<link rel="stylesheet" href="../menu/menu.css">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
});
</script>

<script>
window.PERMISSAO_PAGINA = { area:"app", chave:"inicio" };
</script>

<script src="../login/auth-guard.js"></script>

<style>
:root{
  --marrom:#7b3f2a;
  --bege:#f6efe7;
  --verde:#2f6b2f;
  --vermelho:#c0392b;
  --amarelo:#e0a800;
  --laranja:#e67e22;
  --cinza:#666;
  --logo:#D0B485;
}
*{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Arial}
body{margin:0;background:var(--bege);color:#333}
header{background:var(--logo);padding:15px;text-align:center}
header img{max-width:260px;width:100%}
.container{max-width:900px;margin:20px auto;padding:0 15px}
h2{margin:28px 0 12px;color:var(--marrom)}
.clima-bar{background:#fff;margin:12px auto 16px;padding:10px;border-radius:10px;text-align:center}
.alerta-rapido{display:block;margin:0 auto 20px;padding:12px;border-radius:12px;font-weight:700;text-align:center}
.alerta-ok{background:#eaf6ec;color:var(--verde)}
.alerta-on{background:#fdecea;color:var(--vermelho)}
.card{background:#fff;padding:15px;margin-bottom:12px;border-left:6px solid var(--verde);border-radius:12px}
.card.atrasada{border-color:var(--vermelho)}
.card.pendente{border-color:var(--amarelo)}
</style>
</head>

<body>

<header>
  <img src="../logo.png">
</header>

<div id="menu"></div>

<div class="container">
  <div id="clima" class="clima-bar">‚è≥ Carregando clima...</div>

  <a id="alertaRapido" href="../app/lembretes.html" class="alerta-rapido alerta-ok">
    üîî Nenhum alerta no momento
  </a>

  <div id="conteudo"></div>
</div>

<script>
const db = firebase.firestore();
const clima = document.getElementById("clima");
const conteudo = document.getElementById("conteudo");
const alertaRapido = document.getElementById("alertaRapido");

fetch("../menu/menu.html")
  .then(r=>r.text())
  .then(h=>document.getElementById("menu").innerHTML=h);

const CFG = {
  clima:{},
  vacas:{prenhez_regras:[],gestacao_meses:9},
  vacinas:{status:{finalizada:"Finalizada"}}
};

async function loadConfigs(){
  try{
    const c = await db.collection("config").doc("clima").get();
    if(c.exists) CFG.clima = c.data();
  }catch(e){}

  try{
    const v = await db.collection("config").doc("vacas").get();
    if(v.exists) CFG.vacas = {...CFG.vacas,...v.data()};
  }catch(e){}

  try{
    const vc = await db.collection("config").doc("vacinas").get();
    if(vc.exists) CFG.vacinas = {...CFG.vacinas,...vc.data()};
  }catch(e){}
}

async function loadClima(){
  if(!CFG.clima.latitude){
    clima.innerText="‚òÅÔ∏è Clima indispon√≠vel";
    return;
  }
  clima.innerHTML=`‚òÄÔ∏è ${CFG.clima.cidade || ""}`;
}

async function loadAlertas(){
  const s = await db.collection("lembretes").get();
  alertaRapido.className=s.size?"alerta-rapido alerta-on":"alerta-rapido alerta-ok";
  alertaRapido.innerText=s.size?`üîî ${s.size} itens pendentes`:"üîî Nenhum alerta no momento";
}

async function loadIndex(){
  conteudo.innerHTML="<h2>üìä Sistema operacional</h2><div class='card'>P√°gina carregada com sucesso.</div>";
}

(async()=>{
  await loadConfigs();
  await loadClima();
  await loadAlertas();
  await loadIndex();
})();
</script>

<script src="../login/logout.js"></script>
</body>
</html>